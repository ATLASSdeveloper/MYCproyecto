<!DOCTYPE html>
<html lang="en">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>Articulos1</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" type="text/css" href="./static/css/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="./static/css/styles_menu.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="./static/css/responsive.css">
    <!-- fevicon -->
    <link rel="icon" href="images/fevicon.png" type="image/gif" />
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="./static/css/jquery.mCustomScrollbar.min.css">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700|Righteous&display=swap" rel="stylesheet">
    <!-- owl stylesheets -->
    <link rel="stylesheet" href="./static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
        media="screen">
</head>

<body>
    <!-- header section start -->
    <div class="header_section">
        <div class="header_main">
            <div class="mobile_menu">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="logo_mobile"><a href="menu.html"><img src="./static/images/Menu/logo.png"></a></div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="menu.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="acerca_de.html">Acerca de</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="services.html">Services</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="blog.html">Blog</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="contact.html">Contact</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
            <div class="container-fluid">
                <div class="logo"><a href="menu.html"><img src="./static/images/Menu/logo.png"></a></div>
                <div class="menu_main">
                    <ul>
                        <li class="active"><a href="menu.html">Home</a></li>
                        <li><a href="acerca_de.html">Acerca de</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="contact.html">Contact us</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta name="viewport"
            content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
            integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                
                // Variables
                const baseDeDatos = [
                    {
                        id: 1,
                        nombre: 'Camisa',
                        precio: 15,
                        tipo: 'Ropa',
                        imagen: 'https://ropagallardo.com.ec/wp-content/uploads/2022/03/IMG_3426-2-1-scaled.jpg'
                    },
                    {
                        id: 2,
                        nombre: 'Pantalon',
                        precio: 12,
                        tipo:'Ropa',
                        imagen: 'https://pical.com.ec/pub/media/catalog/product/cache/4d7cebec2a741af81f9d40e6bb974c6b/c/i/ci50-00008-4j.jpg'
                    },
                    {
                        id: 3,
                        nombre: 'Laptop',
                        precio: 90,
                        tipo:'Tecnología',
                        imagen: 'https://www.artefacta.com/media/catalog/product/1/3/133247.png'
                    },
                    {
                        id: 4,
                        nombre: 'PC',
                        precio: 120,
                        tipo:'Tegnología',
                        imagen: 'https://media.wired.com/photos/624df21cb340f55b37084fdc/2:3/w_1200,h_1800,c_limit/How-to-Build-a-PC-Gear.jpg'
                    },
                    {
                        id: 5,
                        nombre: 'Balon Futbol',
                        precio: 5,
                        tipo:'Deporte',
                        imagen: 'https://assets.adidas.com/images/w_1880,f_auto,q_auto/28530d07245942fc944dae680084fb30_9366/H57783_01_standard.jpg'
                    },
                    {
                        id: 6,
                        nombre: 'Raqueta',
                        precio: 20,
                        tipo:'Deporte',
                        imagen: 'https://thesportshop.ec/wp-content/uploads/2019/08/IMG_1323.jpg'
                    }

                ];

                let carrito = [];
                const divisa = '$';
                const DOMitems = document.querySelector('#items');
                const DOMcarrito = document.querySelector('#carrito');
                const DOMtotal = document.querySelector('#total');
                const DOMbotonVaciar = document.querySelector('#boton-vaciar');
                const miLocalStorage = window.localStorage;

                // Funciones

                /**
                * Dibuja todos los productos a partir de la base de datos. No confundir con el carrito
                */
                function renderizarProductos() {
                    baseDeDatos.forEach((info) => {
                        // Estructura
                        const miNodo = document.createElement('div');
                        miNodo.classList.add('card', 'col-sm-5');
                        // Body
                        const miNodoCardBody = document.createElement('div');
                        miNodoCardBody.classList.add('card-body');
                        // Titulo
                        const miNodoTitle = document.createElement('h5');
                        miNodoTitle.classList.add('card-title');
                        miNodoTitle.textContent = info.nombre;
                        // Imagen
                        const miNodoImagen = document.createElement('img');
                        miNodoImagen.classList.add('img-fluid');
                        miNodoImagen.setAttribute('src', info.imagen);
                        // Precio
                        const miNodoPrecio = document.createElement('p');
                        miNodoPrecio.classList.add('card-text');
                        miNodoPrecio.textContent = `${info.precio}${divisa}`;
                        //tipo
                        const miNodoTipo = document.createElement('p');
                        miNodoTipo.classList.add('card-text');
                        miNodoTipo.textContent = info.tipo;
                        // Boton 
                        const miNodoBoton = document.createElement('button');
                        miNodoBoton.classList.add('btn', 'btn-primary');
                        miNodoBoton.textContent = '+';
                        miNodoBoton.setAttribute('marcador', info.id);
                        miNodoBoton.addEventListener('click', anyadirProductoAlCarrito);
                        // Insertamos
                        miNodoCardBody.appendChild(miNodoImagen);
                        miNodoCardBody.appendChild(miNodoTitle);
                        miNodoCardBody.appendChild(miNodoTipo);
                        miNodoCardBody.appendChild(miNodoPrecio);
                        miNodoCardBody.appendChild(miNodoBoton);
                        miNodo.appendChild(miNodoCardBody);
                        DOMitems.appendChild(miNodo);
                    });
                }

                /**
                * Evento para añadir un producto al carrito de la compra
                */
                function anyadirProductoAlCarrito(evento) {
                    // Anyadimos el Nodo a nuestro carrito
                    carrito.push(evento.target.getAttribute('marcador'))
                    // Actualizamos el carrito 
                    renderizarCarrito();
                    // Actualizamos el LocalStorage
                    guardarCarritoEnLocalStorage();
                }

                /**
                * Dibuja todos los productos guardados en el carrito
                */
                function renderizarCarrito() {
                    // Vaciamos todo el html
                    DOMcarrito.textContent = '';
                    // Quitamos los duplicados
                    const carritoSinDuplicados = [...new Set(carrito)];
                    // Generamos los Nodos a partir de carrito
                    carritoSinDuplicados.forEach((item) => {
                        // Obtenemos el item que necesitamos de la variable base de datos
                        const miItem = baseDeDatos.filter((itemBaseDatos) => {
                            // ¿Coincide las id? Solo puede existir un caso
                            return itemBaseDatos.id === parseInt(item);
                        });
                        // Cuenta el número de veces que se repite el producto
                        const numeroUnidadesItem = carrito.reduce((total, itemId) => {
                            // ¿Coincide las id? Incremento el contador, en caso contrario no mantengo
                            return itemId === item ? total += 1 : total;
                        }, 0);
                        // Creamos el nodo del item del carrito
                        const miNodo = document.createElement('li');
                        miNodo.classList.add('list-group-item', 'text-right', 'mx-2');
                        miNodo.textContent = `${numeroUnidadesItem} x ${miItem[0].nombre} - ${miItem[0].precio}${divisa}`;
                        // Boton de borrar
                        const miBoton = document.createElement('button');
                        miBoton.classList.add('btn', 'btn-danger', 'mx-5');
                        miBoton.textContent = 'X';
                        miBoton.style.marginLeft = '1rem';
                        miBoton.dataset.item = item;
                        miBoton.addEventListener('click', borrarItemCarrito);
                        // Mezclamos nodos
                        miNodo.appendChild(miBoton);
                        DOMcarrito.appendChild(miNodo);
                    });
                    // Renderizamos el precio total en el HTML
                    DOMtotal.textContent = calcularTotal();
                }

                /**
                * Evento para borrar un elemento del carrito
                */
                function borrarItemCarrito(evento) {
                    // Obtenemos el producto ID que hay en el boton pulsado
                    const id = evento.target.dataset.item;
                    // Borramos todos los productos
                    carrito = carrito.filter((carritoId) => {
                        return carritoId !== id;
                    });
                    // volvemos a renderizar
                    renderizarCarrito();
                    // Actualizamos el LocalStorage
                    guardarCarritoEnLocalStorage();

                }

                /**
                 * Calcula el precio total teniendo en cuenta los productos repetidos
                 */
                function calcularTotal() {
                    // Recorremos el array del carrito 
                    return carrito.reduce((total, item) => {
                        // De cada elemento obtenemos su precio
                        const miItem = baseDeDatos.filter((itemBaseDatos) => {
                            return itemBaseDatos.id === parseInt(item);
                        });
                        // Los sumamos al total
                        return total + miItem[0].precio;
                    }, 0).toFixed(2);
                }

                /**
                * Varia el carrito y vuelve a dibujarlo
                */
                function vaciarCarrito() {
                    // Limpiamos los productos guardados
                    carrito = [];
                    // Renderizamos los cambios
                    renderizarCarrito();
                    // Borra LocalStorage
                    localStorage.clear();

                }

                function guardarCarritoEnLocalStorage() {
                    miLocalStorage.setItem('carrito', JSON.stringify(carrito));
                }

                function cargarCarritoDeLocalStorage() {
                    // ¿Existe un carrito previo guardado en LocalStorage?
                    if (miLocalStorage.getItem('carrito') !== null) {
                        // Carga la información
                        carrito = JSON.parse(miLocalStorage.getItem('carrito'));
                    }
                }

                // Eventos
                DOMbotonVaciar.addEventListener('click', vaciarCarrito);

                // Inicio
                cargarCarritoDeLocalStorage();
                renderizarProductos();
                renderizarCarrito();
            });
        </script>
    </head>

    <body>
        <div class="container">
            <div class="row">
                <!-- Elementos generados a partir del JSON -->
                <main id="items" class="col-sm-8 row"></main>
                <!-- Carrito -->
                <aside class="col-sm-4">
                    <h2>Carrito</h2>
                    <!-- Elementos del carrito -->
                    <ul id="carrito" class="list-group"></ul>
                    <hr>
                    <!-- Precio total -->
                    <p class="text-right">Total: <span id="total"></span>&dollar;</p>
                    <button id="boton-vaciar" class="btn btn-danger">Vaciar</button>
                </aside>
            </div>
        </div>
    </body>



    <!-- blog section end -->
    <!-- footer section start -->
    <div class="footer_section layout_padding">
        <div class="container">
            <div class="input_btn_main">
                <input type="text" class="mail_text" placeholder="Enter your email" name="Enter your email">
                <div class="subscribe_bt"><a href="#">Subscribe</a></div>
            </div>
            <div class="location_main">
                <div class="call_text"><img src="./static/images/Menu/call-icon.png"></div>
                <div class="call_text"><a href="#">Call +01 1234567890</a></div>
                <div class="call_text"><img src="./static/images/Menu/mail-icon.png"></div>
                <div class="call_text"><a href="#">demo@gmail.com</a></div>
            </div>
            <div class="social_icon">
                <ul>
                    <li><a href="#"><img src="./static/images/Menu/fb-icon.png"></a></li>
                    <li><a href="#"><img src="./static/images/Menu/twitter-icon.png"></a></li>
                    <li><a href="#"><img src="./static/images/Menu/linkedin-icon.png"></a></li>
                    <li><a href="#"><img src="./static/images/Menu/instagram-icon.png"></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- footer section end -->
    <!-- copyright section start -->
    <div class="copyright_section">
        <div class="container">
            <p class="copyright_text">2023 All Rights Reserved. Design by <a href="./menu.html">MiniAmazon</a></p>
        </div>
    </div>
    <!-- copyright section end -->
    <!-- Javascript files-->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="js/plugin.js"></script>
    <!-- sidebar -->
    <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/custom.js"></script>
    <!-- javascript -->
    <script src="js/owl.carousel.js"></script>
    <script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
</body>


</html>